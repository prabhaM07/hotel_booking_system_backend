<!DOCTYPE html>
<html>
<head>
    <title>Profile Image</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .image-container {
            margin: 20px 0;
            text-align: center;
        }
        img {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #4CAF50;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üñºÔ∏è Profile Image Viewer</h1>
        
        <div id="status" class="status loading">Loading...</div>
        
        <h2>Method 1: Direct Image (No Auth)</h2>
        <div class="image-container">
            <img 
                id="directImage"
                src="http://localhost:8000/api/v1/profile_images/1" 
                alt="Profile Image"
                onerror="handleDirectImageError(this)"
            />
            <p id="directStatus">Attempting to load...</p>
        </div>
        
        <h2>Method 2: JavaScript with Auth Token</h2>
        <div class="image-container">
            <img id="profileImage" alt="Profile Image" style="display:none;"/>
            <p id="jsStatus">Loading...</p>
        </div>
        
        <h2>üìä Debug Information</h2>
        <div id="debug" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;"></div>
    </div>
    
    <script>
        let directImageLoaded = false;
        
        function handleDirectImageError(img) {
            directImageLoaded = false;
            img.src = 'https://via.placeholder.com/200?text=Auth+Required';
            document.getElementById('directStatus').innerHTML = '‚ùå Failed (likely needs authentication)';
        }
        
        async function loadProfileImage() {
            const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZW1haWwiOiJqb2huLmRvZUBleGFtcGxlLmNvbSIsInBob25lX25vIjo5ODc2NTQzMjEwLCJyb2xlIjoidXNlciIsImV4cCI6MTc2MTYwNzA4NywidHlwZSI6ImFjY2VzcyJ9.A85HHee4RsaSzADIYxlKzcv1xaeoccmGtm-q4uTo7Qw';
            const statusEl = document.getElementById('status');
            const debugEl = document.getElementById('debug');
            const imgEl = document.getElementById('profileImage');
            const jsStatusEl = document.getElementById('jsStatus');
            
            const apiUrl = 'http://localhost:8000/api/v1/profile_images/1';
            
            debugEl.innerHTML = `
                <strong>üîç Request Details:</strong><br>
                URL: ${apiUrl}<br>
                Method: GET<br>
                Auth: Bearer token (${token.substring(0, 30)}...)<br>
                <br>
                <strong>‚è≥ Fetching...</strong>
            `;
            
            try {
                console.log('Fetching from:', apiUrl);
                
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                console.log('Response:', response);
                
                const contentType = response.headers.get('content-type');
                const contentLength = response.headers.get('content-length');
                
                debugEl.innerHTML += `
                    <br><strong>üì• Response:</strong><br>
                    Status: ${response.status} ${response.statusText}<br>
                    Content-Type: ${contentType}<br>
                    Content-Length: ${contentLength} bytes<br>
                `;
                
                if (response.ok) {
                    const blob = await response.blob();
                    const imageUrl = URL.createObjectURL(blob);
                    
                    imgEl.src = imageUrl;
                    imgEl.style.display = 'block';
                    imgEl.onload = () => {
                        statusEl.className = 'status success';
                        statusEl.innerHTML = '‚úÖ Image loaded successfully!';
                        jsStatusEl.innerHTML = '‚úÖ Loaded with authentication';
                    };
                    
                    debugEl.innerHTML += `<br><strong>‚úÖ Success!</strong><br>Blob size: ${blob.size} bytes<br>Blob type: ${blob.type}`;
                } else {
                    const errorText = await response.text();
                    statusEl.className = 'status error';
                    statusEl.innerHTML = `‚ùå Failed to load image: ${response.status}`;
                    jsStatusEl.innerHTML = `‚ùå Error: ${response.status}`;
                    
                    debugEl.innerHTML += `<br><strong>‚ùå Error Response:</strong><br><pre>${errorText}</pre>`;
                    console.error('Error:', errorText);
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.innerHTML = `‚ùå Error: ${error.message}`;
                jsStatusEl.innerHTML = `‚ùå Network error`;
                
                debugEl.innerHTML += `<br><strong>‚ùå Exception:</strong><br>${error.message}<br>${error.stack}`;
                console.error('Exception:', error);
            }
        }
        
        // Check if direct image loaded
        document.getElementById('directImage').onload = function() {
            if (!directImageLoaded) {
                directImageLoaded = true;
                document.getElementById('directStatus').innerHTML = '‚úÖ Loaded without authentication';
            }
        };
        
        // Start loading with auth
        loadProfileImage();
    </script>
</body>
</html>